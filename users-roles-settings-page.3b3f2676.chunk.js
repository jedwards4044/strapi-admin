(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[8853],{97538:(E,y,t)=>{"use strict";t.r(y),t.d(y,{default:()=>Bt});var e=t(53547),o=t(16550),n=t(5504),i=t(83086),l=t(51725),h=t(46683),c=t(45349),v=t(57713),b=t(79371),M=t(19442),O=t(15483),L=t(26789),g=t(51541),u=t(42403),C=t(6090),f=t(62351),m=t(78549),I=t(22996),U=t(12978),j=t(86896),F=t(75336),B=t(42722);const V=async(s,r)=>{try{const{get:a}=(0,n.getFetchClient)(),{data:d}=await a((0,B.Gc)("roles"));return r("The roles have loaded successfully"),d}catch{throw s({type:"warning",message:{id:"notification.error"}}),new Error("error")}},G=async(s,r)=>{try{const{del:a}=(0,n.getFetchClient)();await a(`${(0,B.Gc)("roles")}/${s}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var ee=t(45697),S=t.n(ee),ue=t(94487),k=t(75878),ae=t(37527),Y=t(36670),re=t(34263);const te=({sortedRoles:s,canDelete:r,permissions:a,setRoleToDelete:d,onDelete:R})=>{const{formatMessage:p}=(0,j.Z)(),{push:D}=(0,o.k6)(),[P,T]=R,A=x=>r&&!["public","authenticated"].includes(x.type),Z=x=>{d(x),T(!P)},$=x=>{D(`/settings/${i.Z}/roles/${x}`)};return e.createElement(ue.p,null,s?.map(x=>e.createElement(C.Tr,{key:x.name,...(0,n.onRowClick)({fn:()=>$(x.id)})},e.createElement(f.Td,{width:"20%"},e.createElement(m.Z,null,x.name)),e.createElement(f.Td,{width:"50%"},e.createElement(m.Z,null,x.description)),e.createElement(f.Td,{width:"30%"},e.createElement(m.Z,null,`${x.nb_users} ${p({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(f.Td,null,e.createElement(k.k,{justifyContent:"end",...n.stopPropagation},e.createElement(n.CheckPermissions,{permissions:a.updateRole},e.createElement(ae.h,{onClick:()=>$(x.id),noBorder:!0,icon:e.createElement(Y.Z,null),label:p({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${x.name}`})})),A(x)&&e.createElement(n.CheckPermissions,{permissions:a.deleteRole},e.createElement(ae.h,{onClick:()=>Z(x.id),noBorder:!0,icon:e.createElement(re.Z,null),label:p({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${x.name}`})})))))))},me=te;te.defaultProps={canDelete:!1},te.propTypes={onDelete:S().array.isRequired,permissions:S().object.isRequired,setRoleToDelete:S().func.isRequired,sortedRoles:S().array.isRequired,canDelete:S().bool};const ge=()=>{const{trackUsage:s}=(0,n.useTracking)(),{formatMessage:r,locale:a}=(0,j.Z)(),{push:d}=(0,o.k6)(),R=(0,n.useNotification)(),{notifyStatus:p}=(0,h.G)(),[{query:D}]=(0,n.useQueryParams)(),P=D?._q||"",[T,A]=(0,e.useState)(!1),[Z,$]=(0,e.useState)(!1),[x,z]=(0,e.useState)();(0,n.useFocusWhenNavigate)();const H=(0,F.useQueryClient)(),N=(0,e.useMemo)(()=>({create:l.Z.createRole,read:l.Z.readRoles,update:l.Z.updateRole,delete:l.Z.deleteRole}),[]),{isLoading:W,allowedActions:{canRead:w,canDelete:_}}=(0,n.useRBAC)(N),{isLoading:St,data:{roles:Se},isFetching:Ut}=(0,F.useQuery)("get-roles",()=>V(R,p),{initialData:{},enabled:w}),{includes:Ue}=(0,n.useFilter)(a,{sensitivity:"base"}),Ze=(0,n.useCollator)(a,{sensitivity:"base"}),$e=St||Ut,Zt=()=>{s("willCreateRole"),d(`/settings/${i.Z}/roles/new`)},$t=()=>{A(!T)},It={roles:{id:(0,B.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,B.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},kt=r({id:"global.roles",defaultMessage:"Roles"}),Ft=(0,F.useMutation)(X=>G(X,R),{async onSuccess(){await H.invalidateQueries("get-roles")}}),Nt=async()=>{$(!0),await Ft.mutateAsync(x),A(!T),$(!1)},de=(Se||[]).filter(X=>Ue(X.name,P)||Ue(X.description,P)).sort((X,Ie)=>Ze.compare(X.name,Ie.name)||Ze.compare(X.description,Ie.description)),Gt=P&&!de.length?"search":"roles",Wt=4,wt=(Se?.length||0)+1;return e.createElement(c.A,null,e.createElement(n.SettingsPageTitle,{name:kt}),e.createElement(v.o,{"aria-busy":$e},e.createElement(b.T,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(n.CheckPermissions,{permissions:l.Z.createRole},e.createElement(M.z,{onClick:Zt,startIcon:e.createElement(U.Z,null),size:"S"},r({id:(0,B.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(O.Z,{startActions:e.createElement(n.SearchURLQuery,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(L.D,null,!w&&e.createElement(n.NoPermissions,null),($e||W)&&e.createElement(n.LoadingIndicatorPage,null),w&&de&&de?.length?e.createElement(g.i,{colCount:Wt,rowCount:wt},e.createElement(u.h,null,e.createElement(C.Tr,null,e.createElement(f.Th,null,e.createElement(m.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.name",defaultMessage:"Name"}))),e.createElement(f.Th,null,e.createElement(m.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.description",defaultMessage:"Description"}))),e.createElement(f.Th,null,e.createElement(m.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.users",defaultMessage:"Users"}))),e.createElement(f.Th,null,e.createElement(I.T,null,r({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(me,{sortedRoles:de,canDelete:_,permissions:l.Z,setRoleToDelete:z,onDelete:[T,A]})):e.createElement(n.EmptyStateLayout,{content:It[Gt]})),e.createElement(n.ConfirmDialog,{isConfirmButtonLoading:Z,onConfirm:Nt,onToggleDialog:$t,isOpen:T})))},oe=()=>e.createElement(n.CheckPagePermissions,{permissions:l.Z.accessRoles},e.createElement(ge,null));var ne=t(94649),K=t(50781),ie=t(9370),Q=t(61585),ye=t(28469),ve=t(20603),xe=t(8675),ke=t(60793),J=t(97961),Fe=t(27361),se=t.n(Fe),Ne=t(41609),Ge=t.n(Ne),We=t(82569),we=t.n(We);const Ce=(0,e.createContext)({}),Re=({children:s,value:r})=>e.createElement(Ce.Provider,{value:r},s),he=()=>(0,e.useContext)(Ce);Re.propTypes={children:S().node.isRequired,value:S().object.isRequired};var le=t(88972),Ke=t(35161),ze=t.n(Ke),He=t(13217),Ve=t.n(He);const Qe=s=>{switch(s){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Xe=(0,le.default)(K.x)`
  margin: -1px;
  border-radius: ${({theme:s})=>s.spaces[1]} 0 0 ${({theme:s})=>s.spaces[1]};
`;function Ee({route:s}){const{formatMessage:r}=(0,j.Z)(),{method:a,handler:d,path:R}=s,p=R?Ve()(R.split("/")):[],[D="",P=""]=d?d.split("."):[],T=Qe(s.method);return e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(m.Z,{variant:"delta",as:"h3"},r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,D),e.createElement(m.Z,{variant:"delta",textColor:"primary600"},".",P)),e.createElement(k.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Xe,{background:T.background,borderColor:T.border,padding:2},e.createElement(m.Z,{fontWeight:"bold",textColor:T.text},a)),e.createElement(K.x,{paddingLeft:2,paddingRight:2},ze()(p,A=>e.createElement(m.Z,{key:A,textColor:A.includes(":")?"neutral600":"neutral900"},"/",A)))))}Ee.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},Ee.propTypes={route:S().shape({handler:S().string,method:S().string,path:S().string})};const Ye=Ee,Je=()=>{const{formatMessage:s}=(0,j.Z)(),{selectedAction:r,routes:a}=he(),d=we()(r.split("."),"controllers"),R=se()(a,d[0]),p=d.slice(1).join("."),D=Ge()(R)?[]:R.filter(P=>P.handler.endsWith(p));return e.createElement(Q.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},r?e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},D.map((P,T)=>e.createElement(Ye,{key:T,route:P}))):e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(m.Z,{variant:"delta",as:"h3"},s({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(m.Z,{as:"p",textColor:"neutral600"},s({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var qe=t(97104),_e=t(27375),et=t(37362),tt=t(11700),nt=t.n(tt);function st(s){switch(s){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return nt()(s.replace("api::","").replace("plugin::",""))}}const at=st;var rt=t(89734),Pe=t.n(rt),Ae=t(13539),ot=t(80606);const Te=(0,le.css)`
  background: ${s=>s.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,it=(0,le.default)(K.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${s=>s.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${s=>s.isActive&&Te}
  &:hover {
    ${Te}
  }
`,lt=le.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,De=({subCategory:s})=>{const{formatMessage:r}=(0,j.Z)(),{onChange:a,onChangeSelectAll:d,onSelectedAction:R,selectedAction:p,modifiedData:D}=he(),P=(0,e.useMemo)(()=>se()(D,s.name,{}),[D,s]),T=(0,e.useMemo)(()=>Object.values(P).every(x=>x.enabled===!0),[P]),A=(0,e.useMemo)(()=>Object.values(P).some(x=>x.enabled===!0)&&!T,[P,T]),Z=(0,e.useCallback)(({target:{name:x}})=>{d({target:{name:x,value:!T}})},[T,d]),$=(0,e.useCallback)(x=>p===x,[p]);return e.createElement(K.x,null,e.createElement(k.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(K.x,{paddingRight:4},e.createElement(m.Z,{variant:"sigma",textColor:"neutral600"},s.label)),e.createElement(lt,null),e.createElement(K.x,{paddingLeft:4},e.createElement(Ae.X,{name:s.name,value:T,onValueChange:x=>Z({target:{name:s.name,value:x}}),indeterminate:A},r({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(k.k,{paddingTop:6,paddingBottom:6},e.createElement(ie.r,{gap:2,style:{flex:1}},s.actions.map(x=>{const z=`${x.name}.enabled`;return e.createElement(Q.P,{col:6,key:x.name},e.createElement(it,{isActive:$(x.name),padding:2,hasRadius:!0},e.createElement(Ae.X,{value:se()(D,z,!1),name:z,onValueChange:H=>a({target:{name:z,value:H}})},x.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>R(x.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(ot.Z,null))))}))))};De.propTypes={subCategory:S().object.isRequired};const ct=De,be=({name:s,permissions:r})=>{const a=(0,e.useMemo)(()=>Pe()(Object.values(r.controllers).reduce((d,R,p)=>{const D=`${s}.controllers.${Object.keys(r.controllers)[p]}`,P=Pe()(Object.keys(R).reduce((T,A)=>[...T,{...R[A],label:A,name:`${D}.${A}`}],[]),"label");return[...d,{actions:P,label:Object.keys(r.controllers)[p],name:D}]},[]),"label"),[s,r]);return e.createElement(K.x,{padding:6},a.map(d=>e.createElement(ct,{key:d.name,subCategory:d})))};be.propTypes={name:S().string.isRequired,permissions:S().object.isRequired};const dt=be,ut=(s,r)=>{const a=Object.keys(r).sort().map(d=>({name:d,isOpen:!1}));return{...s,collapses:a}};var ce=t(18172);const mt={collapses:[]},gt=(s,r)=>(0,ce.default)(s,a=>{switch(r.type){case"TOGGLE_COLLAPSE":{a.collapses=s.collapses.map((d,R)=>R===r.index?{...d,isOpen:!d.isOpen}:{...d,isOpen:!1});break}default:return a}}),pt=()=>{const{modifiedData:s}=he(),{formatMessage:r}=(0,j.Z)(),[{collapses:a},d]=(0,e.useReducer)(gt,mt,p=>ut(p,s)),R=p=>d({type:"TOGGLE_COLLAPSE",index:p});return e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:1},a.map((p,D)=>e.createElement(qe.U,{expanded:p.isOpen,onToggle:()=>R(D),key:p.name,variant:D%2===0?"secondary":void 0},e.createElement(_e.B,{title:at(p.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:p.name}),variant:D%2?"primary":"secondary"}),e.createElement(et.v,null,e.createElement(K.x,null,e.createElement(dt,{permissions:s[p.name],name:p.name}))))))};var ht=t(36968),Me=t.n(ht),Et=t(69572),ft=t.n(Et);const yt={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},vt=(s,r)=>(0,ce.default)(s,a=>{switch(r.type){case"ON_CHANGE":{const d=r.keys.length,R=r.keys[d-1]==="enabled";if(r.value&&R){const p=ft()(r.keys,d-1).join(".");a.selectedAction=p}Me()(a,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const d=["modifiedData",...r.keys],R=se()(s,d,{}),p=Object.keys(R).reduce((D,P)=>(D[P]={...R[P],enabled:r.value},D),{});Me()(a,d,p);break}case"ON_RESET":{a.modifiedData=s.initialData;break}case"ON_SUBMIT_SUCCEEDED":{a.initialData=s.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:d}=r;a.selectedAction=d===s.selectedAction?"":d;break}default:return a}}),xt=(s,r,a)=>({...s,initialData:r,modifiedData:r,routes:a}),Le=(0,e.forwardRef)(({permissions:s,routes:r},a)=>{const{formatMessage:d}=(0,j.Z)(),[R,p]=(0,e.useReducer)(vt,yt,Z=>xt(Z,s,r));(0,e.useImperativeHandle)(a,()=>({getPermissions(){return{permissions:R.modifiedData}},resetForm(){p({type:"ON_RESET"})},setFormAfterSubmit(){p({type:"ON_SUBMIT_SUCCEEDED"})}}));const A={...R,onChange:({target:{name:Z,value:$}})=>p({type:"ON_CHANGE",keys:Z.split("."),value:$==="empty__string_value"?"":$}),onChangeSelectAll:({target:{name:Z,value:$}})=>p({type:"ON_CHANGE_SELECT_ALL",keys:Z.split("."),value:$}),onSelectedAction:Z=>p({type:"SELECT_ACTION",actionToSelect:Z})};return e.createElement(Re,{value:A},e.createElement(ie.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(Q.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(m.Z,{variant:"delta",as:"h2"},d({id:(0,J.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(m.Z,{as:"p",textColor:"neutral600"},d({id:(0,J.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(pt,null))),e.createElement(Je,null)))});Le.propTypes={permissions:S().object.isRequired,routes:S().object.isRequired};const Oe=(0,e.memo)(Le),Jt={isLoading:!0,modifiedData:{}},qt=(s,r)=>produce(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.modifiedData={};break}case"GET_DATA_SUCCEEDED":{a.isLoading=!1,a.modifiedData=r.data;break}case"GET_DATA_ERROR":{a.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{a.modifiedData=r.data;break}default:return a}}),_t=null,en=(s,r)=>{const{isLoading:a,allowedActions:d}=useRBAC(r),[{isLoading:R,modifiedData:p},D]=useReducer(reducer,initialState),P=useNotification(),T=useRef(!0),{get:A}=useFetchClient();useEffect(()=>(a||(async()=>{try{D({type:"GET_DATA"});const{data:x}=await A(getRequestURL(s));D({type:"GET_DATA_SUCCEEDED",data:x})}catch(x){T.current&&(D({type:"GET_DATA_ERROR"}),console.error(x),P({type:"warning",message:{id:"notification.error"}}))}})(),()=>{T.current=!1}),[a,s,A,P]);const Z=useCallback($=>{D({type:"ON_SUBMIT_SUCCEEDED",data:$})},[]);return{allowedActions:d,dispatchSubmitSucceeded:Z,isLoading:R,isLoadingForPermissions:a,modifiedData:p}},tn=null,nn={roles:[],isLoading:!0},sn=(s,r)=>produce(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.roles=[];break}case"GET_DATA_SUCCEEDED":{a.roles=r.data,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),an=null,rn=(s=!0)=>{const[{roles:r,isLoading:a},d]=useReducer(reducer,initialState,()=>init(initialState,s)),R=useNotification(),p=useRef(!0),D=useFetchClient(),P=useCallback(async()=>{try{d({type:"GET_DATA"});const{data:{roles:T}}=await D.get(`/${pluginId}/roles`);d({type:"GET_DATA_SUCCEEDED",data:T})}catch(T){const A=get(T,["response","payload","message"],"An error occured");p.current&&(d({type:"GET_DATA_ERROR"}),A!=="Forbidden"&&R({type:"warning",message:A}))}},[D,R]);return useEffect(()=>(s&&P(),()=>{p.current=!1}),[s,P]),{roles:r,isLoading:a,getData:P}},on=null,Ct=(s,r)=>({...s,isLoading:r}),je={permissions:{},routes:{},isLoading:!0},Rt=(s,r)=>(0,ce.default)(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.permissions={},a.routes={};break}case"GET_DATA_SUCCEEDED":{a.permissions=r.permissions,a.routes=r.routes,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),Be=(s=!0)=>{const r=(0,n.useNotification)(),[{permissions:a,routes:d,isLoading:R},p]=(0,e.useReducer)(Rt,je,()=>Ct(je,s)),D=(0,n.useFetchClient)(),P=(0,e.useCallback)(async()=>{try{p({type:"GET_DATA"});const[{permissions:T},{routes:A}]=await Promise.all([`/${i.Z}/permissions`,`/${i.Z}/routes`].map(async Z=>(await D.get(Z)).data));p({type:"GET_DATA_SUCCEEDED",permissions:(0,B.YX)(T),routes:A})}catch(T){const A=se()(T,["response","payload","message"],"An error occured");p({type:"GET_DATA_ERROR"}),A!=="Forbidden"&&r({type:"warning",message:A})}},[r]);return(0,e.useEffect)(()=>{s&&P()},[P,s]),{permissions:a,routes:d,getData:P,isLoading:R}},Pt={role:{},isLoading:!0},At=(s,r)=>(0,ce.default)(s,a=>{switch(r.type){case"GET_DATA_SUCCEEDED":{a.role=r.role,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{a.role.name=r.name,a.role.description=r.description;break}default:return a}}),Tt=s=>{const[r,a]=(0,e.useReducer)(At,Pt),d=(0,n.useNotification)(),R=(0,e.useRef)(null),{get:p}=(0,n.useFetchClient)();(0,e.useEffect)(()=>(R.current=!0,s?D(s):a({type:"GET_DATA_SUCCEEDED",role:{}}),()=>R.current=!1),[s]);const D=async T=>{try{const{data:{role:A}}=await p(`/${i.Z}/roles/${T}`);R.current&&a({type:"GET_DATA_SUCCEEDED",role:A})}catch(A){console.error(A),a({type:"GET_DATA_ERROR"}),d({type:"warning",message:{id:"notification.error"}})}},P=(0,e.useCallback)(T=>{a({type:"ON_SUBMIT_SUCCEEDED",...T})},[]);return{...r,onSubmitSucceeded:P}};var q=t(87561);const Dt=q.object().shape({name:q.string().required(n.translatedErrors.required),description:q.string().required(n.translatedErrors.required)}),bt=()=>{const{formatMessage:s}=(0,j.Z)(),[r,a]=(0,e.useState)(!1),d=(0,n.useNotification)(),{lockApp:R,unlockApp:p}=(0,n.useOverlayBlocker)(),{params:{id:D}}=(0,o.$B)(`/settings/${i.Z}/roles/:id`),{isLoading:P,routes:T}=Be(),{role:A,onSubmitSucceeded:Z,isLoading:$}=Tt(D),x=(0,e.useRef)(),{put:z}=(0,n.useFetchClient)(),H=async N=>{R(),a(!0);try{const W=x.current.getPermissions();await z(`/${i.Z}/roles/${D}`,{...N,...W,users:[]}),Z({name:N.name,description:N.description}),d({type:"success",message:{id:(0,J.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(W){console.error(W),d({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),p()};return $?e.createElement(n.LoadingIndicatorPage,null):e.createElement(v.o,null,e.createElement(n.SettingsPageTitle,{name:"Roles"}),e.createElement(ne.Formik,{enableReinitialize:!0,initialValues:{name:A.name,description:A.description},onSubmit:H,validationSchema:Dt},({handleSubmit:N,values:W,handleChange:w,errors:_})=>e.createElement(n.Form,{noValidate:!0,onSubmit:N},e.createElement(b.T,{primaryAction:!P&&e.createElement(M.z,{disabled:A.code==="strapi-super-admin",type:"submit",loading:r,startIcon:e.createElement(xe.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:A.name,subtitle:A.description,navigationAction:e.createElement(n.Link,{startIcon:e.createElement(ke.Z,null),to:"/settings/users-permissions/roles"},s({id:"global.back",defaultMessage:"Back"}))}),e.createElement(L.D,null,e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(K.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(m.Z,{variant:"delta",as:"h2"},s({id:(0,J.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(ie.r,{gap:4},e.createElement(Q.P,{col:6},e.createElement(ye.o,{name:"name",value:W.name||"",onChange:w,label:s({id:"global.name",defaultMessage:"Name"}),error:_.name?s({id:_.name,defaultMessage:"Invalid value"}):null})),e.createElement(Q.P,{col:6},e.createElement(ve.g,{name:"description",value:W.description||"",onChange:w,label:s({id:"global.description",defaultMessage:"Description"}),error:_.description?s({id:_.description,defaultMessage:"Invalid value"}):null}))))),!P&&e.createElement(Oe,{ref:x,permissions:A.permissions,routes:T}))))))},Mt=()=>e.createElement(n.CheckPagePermissions,{permissions:l.Z.updateRole},e.createElement(bt,null)),Lt=q.object().shape({name:q.string().required(n.translatedErrors.required),description:q.string().required(n.translatedErrors.required)}),Ot=()=>{const{formatMessage:s}=(0,j.Z)(),[r,a]=(0,e.useState)(!1),d=(0,n.useNotification)(),{goBack:R}=(0,o.k6)(),{lockApp:p,unlockApp:D}=(0,n.useOverlayBlocker)(),{isLoading:P,permissions:T,routes:A}=Be(),{trackUsage:Z}=(0,n.useTracking)(),$=(0,e.useRef)(),{post:x}=(0,n.useFetchClient)(),z=async H=>{p(),a(!0);try{const N=$.current.getPermissions();await x(`/${i.Z}/roles`,{...H,...N,users:[]}),Z("didCreateRole"),d({type:"success",message:{id:(0,J.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),R()}catch(N){console.error(N),d({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),D()};return e.createElement(v.o,null,e.createElement(n.SettingsPageTitle,{name:"Roles"}),e.createElement(ne.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:z,validationSchema:Lt},({handleSubmit:H,values:N,handleChange:W,errors:w})=>e.createElement(n.Form,{noValidate:!0,onSubmit:H},e.createElement(b.T,{primaryAction:!P&&e.createElement(M.z,{type:"submit",loading:r,startIcon:e.createElement(xe.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:s({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(L.D,null,e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(K.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(m.Z,{variant:"delta",as:"h2"},s({id:(0,J.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(ie.r,{gap:4},e.createElement(Q.P,{col:6},e.createElement(ye.o,{name:"name",value:N.name||"",onChange:W,label:s({id:"global.name",defaultMessage:"Name"}),error:w.name?s({id:w.name,defaultMessage:"Invalid value"}):null})),e.createElement(Q.P,{col:6},e.createElement(ve.g,{name:"description",value:N.description||"",onChange:W,label:s({id:"global.description",defaultMessage:"Description"}),error:w.description?s({id:w.description,defaultMessage:"Invalid value"}):null}))))),!P&&e.createElement(Oe,{ref:$,permissions:T,routes:A}))))))},jt=()=>e.createElement(n.CheckPagePermissions,{permissions:l.Z.createRole},e.createElement(Ot,null)),Bt=()=>e.createElement(n.CheckPagePermissions,{permissions:l.Z.accessRoles},e.createElement(o.rs,null,e.createElement(o.AW,{path:`/settings/${i.Z}/roles/new`,component:jt,exact:!0}),e.createElement(o.AW,{path:`/settings/${i.Z}/roles/:id`,component:Mt,exact:!0}),e.createElement(o.AW,{path:`/settings/${i.Z}/roles`,component:oe,exact:!0}),e.createElement(o.AW,{path:"",component:n.AnErrorOccurred})))},42722:(E,y,t)=>{"use strict";t.d(y,{YX:()=>i,Gc:()=>c,OB:()=>v.Z});var e=t(41609),o=t.n(e);const i=b=>Object.keys(b).reduce((M,O)=>{const L=b[O].controllers,g=Object.keys(L).reduce((u,C)=>(o()(L[C])||(u[C]=L[C]),u),{});return o()(g)||(M[O]={controllers:g}),M},{});var l=t(83086);const c=b=>`/${l.Z}/${b}`;var v=t(97961)},47443:(E,y,t)=>{var e=t(42118);function o(n,i){var l=n==null?0:n.length;return!!l&&e(n,i,0)>-1}E.exports=o},1196:E=>{function y(t,e,o){for(var n=-1,i=t==null?0:t.length;++n<i;)if(o(e,t[n]))return!0;return!1}E.exports=y},20731:(E,y,t)=>{var e=t(88668),o=t(47443),n=t(1196),i=t(29932),l=t(7518),h=t(74757),c=200;function v(b,M,O,L){var g=-1,u=o,C=!0,f=b.length,m=[],I=M.length;if(!f)return m;O&&(M=i(M,l(O))),L?(u=n,C=!1):M.length>=c&&(u=h,C=!1,M=new e(M));e:for(;++g<f;){var U=b[g],j=O==null?U:O(U);if(U=L||U!==0?U:0,C&&j===j){for(var F=I;F--;)if(M[F]===j)continue e;m.push(U)}else u(M,j,L)||m.push(U)}return m}E.exports=v},89881:(E,y,t)=>{var e=t(47816),o=t(99291),n=o(e);E.exports=n},41848:E=>{function y(t,e,o,n){for(var i=t.length,l=o+(n?1:-1);n?l--:++l<i;)if(e(t[l],l,t))return l;return-1}E.exports=y},42118:(E,y,t)=>{var e=t(41848),o=t(62722),n=t(42351);function i(l,h,c){return h===h?n(l,h,c):e(l,o,c)}E.exports=i},62722:E=>{function y(t){return t!==t}E.exports=y},69199:(E,y,t)=>{var e=t(89881),o=t(98612);function n(i,l){var h=-1,c=o(i)?Array(i.length):[];return e(i,function(v,b,M){c[++h]=l(v,b,M)}),c}E.exports=n},82689:(E,y,t)=>{var e=t(29932),o=t(97786),n=t(67206),i=t(69199),l=t(71131),h=t(7518),c=t(85022),v=t(6557),b=t(1469);function M(O,L,g){L.length?L=e(L,function(f){return b(f)?function(m){return o(m,f.length===1?f[0]:f)}:f}):L=[v];var u=-1;L=e(L,h(n));var C=i(O,function(f,m,I){var U=e(L,function(j){return j(f)});return{criteria:U,index:++u,value:f}});return l(C,function(f,m){return c(f,m,g)})}E.exports=M},71131:E=>{function y(t,e){var o=t.length;for(t.sort(e);o--;)t[o]=t[o].value;return t}E.exports=y},26393:(E,y,t)=>{var e=t(33448);function o(n,i){if(n!==i){var l=n!==void 0,h=n===null,c=n===n,v=e(n),b=i!==void 0,M=i===null,O=i===i,L=e(i);if(!M&&!L&&!v&&n>i||v&&b&&O&&!M&&!L||h&&b&&O||!l&&O||!c)return 1;if(!h&&!v&&!L&&n<i||L&&l&&c&&!h&&!v||M&&l&&c||!b&&c||!O)return-1}return 0}E.exports=o},85022:(E,y,t)=>{var e=t(26393);function o(n,i,l){for(var h=-1,c=n.criteria,v=i.criteria,b=c.length,M=l.length;++h<b;){var O=e(c[h],v[h]);if(O){if(h>=M)return O;var L=l[h];return O*(L=="desc"?-1:1)}}return n.index-i.index}E.exports=o},99291:(E,y,t)=>{var e=t(98612);function o(n,i){return function(l,h){if(l==null)return l;if(!e(l))return n(l,h);for(var c=l.length,v=i?c:-1,b=Object(l);(i?v--:++v<c)&&h(b[v],v,b)!==!1;);return l}}E.exports=o},42351:E=>{function y(t,e,o){for(var n=o-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}E.exports=y},35161:(E,y,t)=>{var e=t(29932),o=t(67206),n=t(69199),i=t(1469);function l(h,c){var v=i(h)?e:n;return v(h,o(c,3))}E.exports=l},89734:(E,y,t)=>{var e=t(21078),o=t(82689),n=t(5976),i=t(16612),l=n(function(h,c){if(h==null)return[];var v=c.length;return v>1&&i(h,c[0],c[1])?c=[]:v>2&&i(c[0],c[1],c[2])&&(c=[c[0]]),o(h,e(c,1),[])});E.exports=l},13217:(E,y,t)=>{var e=t(14259);function o(n){var i=n==null?0:n.length;return i?e(n,1,i):[]}E.exports=o},69572:(E,y,t)=>{var e=t(14259),o=t(40554);function n(i,l,h){return i&&i.length?(l=h||l===void 0?1:o(l),e(i,0,l<0?0:l)):[]}E.exports=n},82569:(E,y,t)=>{var e=t(20731),o=t(5976),n=t(29246),i=o(function(l,h){return n(l)?e(l,h):[]});E.exports=i},97104:(E,y,t)=>{"use strict";t.d(y,{U:()=>L,y:()=>M});var e=t(2790),o=t(53547),n=t(88972),i=t(7535),l=t(73879),h=t(78549),c=t(75878),v=t(50781);const b=({theme:g,expanded:u,variant:C,disabled:f,error:m})=>m?`1px solid ${g.colors.danger600} !important`:f?`1px solid ${g.colors.neutral150}`:u?`1px solid ${g.colors.primary600}`:C==="primary"?`1px solid ${g.colors.neutral0}`:`1px solid ${g.colors.neutral100}`,M=(0,n.default)(h.Z)``,O=(0,n.default)(v.x)`
  border: ${b};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:g})=>g.colors.primary600};

    ${M} {
      color: ${({theme:g,expanded:u})=>u?void 0:g.colors.primary700};
    }

    ${h.Z} {
      color: ${({theme:g,expanded:u})=>u?void 0:g.colors.primary600};
    }

    & > ${c.k} {
      background: ${({theme:g})=>g.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:g})=>g.colors.primary200};
    }
  }
`,L=({children:g,disabled:u=!1,error:C,expanded:f=!1,hasErrorMessage:m=!0,id:I,onToggle:U,toggle:j,size:F="M",variant:B="primary",shadow:V})=>{const G=(0,l.M)(I),ee=o.useMemo(()=>({expanded:f,onToggle:U,toggle:j,id:G,size:F,variant:B,disabled:u}),[u,f,G,U,F,j,B]);return(0,e.jsxs)(i.S.Provider,{value:ee,children:[(0,e.jsx)(O,{"data-strapi-expanded":f,disabled:u,"aria-disabled":u,expanded:f,hasRadius:!0,variant:B,error:C,shadow:V,children:g}),C&&m&&(0,e.jsx)(v.x,{paddingTop:1,children:(0,e.jsx)(h.Z,{variant:"pi",textColor:"danger600",children:C})})]})}},37362:(E,y,t)=>{"use strict";t.d(y,{v:()=>i});var e=t(2790),o=t(7535),n=t(50781);const i=({children:l,...h})=>{const{expanded:c,id:v}=(0,o.A)();if(!c)return null;const b=`accordion-content-${v}`,M=`accordion-label-${v}`,O=`accordion-desc-${v}`;return(0,e.jsx)(n.x,{role:"region",id:b,"aria-labelledby":M,"aria-describedby":O,...h,children:l})}},7535:(E,y,t)=>{"use strict";t.d(y,{A:()=>n,S:()=>o});var e=t(53547);const o=(0,e.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),n=()=>(0,e.useContext)(o)},27375:(E,y,t)=>{"use strict";t.d(y,{B:()=>g});var e=t(2790),o=t(21514),n=t(88972),i=t(97104),l=t(7535);const h=({expanded:u,disabled:C,variant:f})=>{let m="neutral100";return u?m="primary100":C?m="neutral150":f==="primary"&&(m="neutral0"),m};var c=t(90139),v=t(80907),b=t(75878),M=t(78549);const O=(0,n.default)(c.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:u,expanded:C})=>C?u.colors.primary600:u.colors.neutral500};
    }
  }
`,L=(0,n.default)(b.k)`
  min-height: ${({theme:u,size:C})=>u.sizes.accordions[C]};
  border-radius: ${({theme:u,expanded:C})=>C?`${u.borderRadius} ${u.borderRadius} 0 0`:u.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:u})=>u.colors.primary600};
      }
    }
  }
`,g=({title:u,description:C,as:f="span",togglePosition:m="right",action:I,...U})=>{const{onToggle:j,toggle:F,expanded:B,id:V,size:G,variant:ee,disabled:S}=(0,l.A)(),ue=`accordion-content-${V}`,k=`accordion-label-${V}`,ae=`accordion-desc-${V}`,Y=G==="M"?6:4,re=G==="M"?Y:Y-2,te=h({expanded:B,disabled:S,variant:ee}),me={as:f,fontWeight:G==="S"?"bold":void 0,id:k,textColor:B?"primary600":"neutral700",ellipsis:!0,variant:G==="M"?"delta":void 0},fe=B?"primary600":"neutral600",ge=B?"primary200":"neutral200",pe=G==="M"?`${32/16}rem`:`${24/16}rem`,oe=()=>{S||(F&&!j?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),F()):j&&j())},ne=(0,e.jsx)(b.k,{justifyContent:"center",borderRadius:"50%",height:pe,width:pe,transform:B?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ge,cursor:S?"not-allowed":"pointer",onClick:oe,shrink:0,children:(0,e.jsx)(v.J,{as:o.Z,width:G==="M"?`${11/16}rem`:`${8/16}rem`,color:B?"primary600":"neutral600"})});return(0,e.jsx)(L,{paddingBottom:re,paddingLeft:Y,paddingRight:Y,paddingTop:re,background:te,expanded:B,size:G,justifyContent:"space-between",cursor:S?"not-allowed":"",children:(0,e.jsxs)(b.k,{gap:3,flex:1,maxWidth:"100%",children:[m==="left"&&ne,(0,e.jsx)(O,{onClick:oe,"aria-disabled":S,"aria-expanded":B,"aria-controls":ue,"aria-labelledby":k,"data-strapi-accordion-toggle":!0,expanded:B,type:"button",flex:1,minWidth:0,...U,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.y,{...me,children:u}),C&&(0,e.jsx)(M.Z,{as:"p",id:ae,textColor:fe,children:C})]})}),m==="right"&&(0,e.jsxs)(b.k,{gap:3,children:[ne,I]}),m==="left"&&I]})})}},15483:(E,y,t)=>{"use strict";t.d(y,{Z:()=>n});var e=t(2790),o=t(75878);const n=({startActions:i,endActions:l})=>!i&&!l?null:(0,e.jsxs)(o.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(o.k,{gap:2,wrap:"wrap",children:i}),(0,e.jsx)(o.k,{gap:2,shrink:0,wrap:"wrap",children:l})]})},26789:(E,y,t)=>{"use strict";t.d(y,{D:()=>n});var e=t(2790),o=t(50781);const n=({children:i})=>(0,e.jsx)(o.x,{paddingLeft:10,paddingRight:10,children:i})},79371:(E,y,t)=>{"use strict";t.d(y,{T:()=>M});var e=t(2790),o=t(53547),n=t(88972);const i=g=>{const u=(0,o.useRef)(null),[C,f]=(0,o.useState)(!0),m=([I])=>{f(I.isIntersecting)};return(0,o.useEffect)(()=>{const I=u.current,U=new IntersectionObserver(m,g);return I&&U.observe(u.current),()=>{I&&U.disconnect()}},[u,g]),[u,C]};var l=t(79698);const h=(g,u)=>{const C=(0,l.W)(u);(0,o.useLayoutEffect)(()=>{const f=new ResizeObserver(C);return Array.isArray(g)?g.forEach(m=>{m.current&&f.observe(m.current)}):g.current&&f.observe(g.current),()=>{f.disconnect()}},[g,C])};var c=t(50781),v=t(75878),b=t(78549);const M=g=>{const u=(0,o.useRef)(null),[C,f]=(0,o.useState)(null),[m,I]=i({root:null,rootMargin:"0px",threshold:0});return h(m,()=>{m.current&&f(m.current.getBoundingClientRect())}),(0,o.useEffect)(()=>{u.current&&f(u.current.getBoundingClientRect())},[u]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{height:C?.height},ref:m,children:I&&(0,e.jsx)(L,{ref:u,...g})}),!I&&(0,e.jsx)(L,{...g,sticky:!0,width:C?.width})]})};M.displayName="HeaderLayout";const O=(0,n.default)(c.x)`
  width: ${({width:g})=>g?`${g/16}rem`:void 0};
  z-index: ${({theme:g})=>g.zIndices[1]};
`,L=o.forwardRef(({navigationAction:g,primaryAction:u,secondaryAction:C,subtitle:f,title:m,sticky:I,width:U,...j},F)=>{const B=typeof f=="string";return I?(0,e.jsx)(O,{paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3,position:"fixed",top:0,right:0,background:"neutral0",shadow:"tableShadow",width:U,"data-strapi-header-sticky":!0,children:(0,e.jsxs)(v.k,{justifyContent:"space-between",children:[(0,e.jsxs)(v.k,{children:[g&&(0,e.jsx)(c.x,{paddingRight:3,children:g}),(0,e.jsxs)(c.x,{children:[(0,e.jsx)(b.Z,{variant:"beta",as:"h1",...j,children:m}),B?(0,e.jsx)(b.Z,{variant:"pi",textColor:"neutral600",children:f}):f]}),C?(0,e.jsx)(c.x,{paddingLeft:4,children:C}):null]}),(0,e.jsx)(v.k,{children:u?(0,e.jsx)(c.x,{paddingLeft:2,children:u}):void 0})]})}):(0,e.jsxs)(c.x,{ref:F,paddingLeft:10,paddingRight:10,paddingBottom:8,paddingTop:g?6:8,background:"neutral100","data-strapi-header":!0,children:[g?(0,e.jsx)(c.x,{paddingBottom:2,children:g}):null,(0,e.jsxs)(v.k,{justifyContent:"space-between",children:[(0,e.jsxs)(v.k,{minWidth:0,children:[(0,e.jsx)(b.Z,{as:"h1",variant:"alpha",...j,children:m}),C?(0,e.jsx)(c.x,{paddingLeft:4,children:C}):null]}),u]}),B?(0,e.jsx)(b.Z,{variant:"epsilon",textColor:"neutral600",as:"p",children:f}):f]})})},45349:(E,y,t)=>{"use strict";t.d(y,{A:()=>h});var e=t(2790),o=t(88972),n=t(50781);const i=(0,o.default)(n.x)`
  display: grid;
  grid-template-columns: ${({hasSideNav:c})=>c?"auto 1fr":"1fr"};
`,l=(0,o.default)(n.x)`
  overflow-x: hidden;
`,h=({sideNav:c,children:v})=>(0,e.jsxs)(i,{hasSideNav:!!c,children:[c,(0,e.jsx)(l,{paddingBottom:10,children:v})]})},57713:(E,y,t)=>{"use strict";t.d(y,{o:()=>l});var e=t(2790),o=t(88972),n=t(50781);const i=(0,o.default)(n.x)`
  // To prevent global outline on focus visible to force an outline when Main is focused
  &:focus-visible {
    outline: none;
  }
`,l=({labelledBy:h="main-content-title",...c})=>(0,e.jsx)(i,{"aria-labelledby":h,as:"main",id:"main-content",tabIndex:-1,...c})}}]);
