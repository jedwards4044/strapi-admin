"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[8056],{92668:(z,E,t)=>{t.d(E,{Z:()=>W});var e=t(53547),s=t(94487),P=t(6090),m=t(62351),k=t(78549),U=t(75878),l=t(5504),x=t(45697),n=t.n(x),A=t(86896),N=t(16550),V=t(50781),R=t(37527),F=t(34263);const T=({tokenName:a,onClickDelete:r,tokenType:c})=>{const{formatMessage:y}=(0,A.Z)(),{trackUsage:u}=(0,l.useTracking)(),[p,g]=(0,e.useState)(!1),v=()=>{g(!1),u("willDeleteToken",{tokenType:c}),r()};return e.createElement(V.x,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(R.h,{onClick:()=>{g(!0)},label:y({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:e.createElement(F.Z,null)}),e.createElement(l.ConfirmDialog,{onToggleDialog:()=>g(!1),onConfirm:v,isOpen:p}))};T.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const O=T;var G=t(2953),$=t(88972);const K={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},H=(0,$.default)(l.Link)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,Z=({tokenName:a,tokenId:r,buttonType:c,children:y})=>{const{formatMessage:u}=(0,A.Z)(),{location:{pathname:p}}=(0,N.k6)();return e.createElement(H,{to:`${p}/${r}`,title:u(K[c],{target:a})},y)};Z.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},Z.defaultProps={buttonType:"edit"};const b=Z,h=({tokenName:a,tokenId:r})=>e.createElement(b,{tokenName:a,tokenId:r,buttonType:"read"},e.createElement(G.Z,null));h.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const f=h;var D=t(36670);const I=({tokenName:a,tokenId:r})=>e.createElement(b,{tokenName:a,tokenId:r},e.createElement(D.Z,null));I.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const S=I,L=({permissions:a,headers:r,contentType:c,isLoading:y,tokens:u,onConfirmDelete:p,tokenType:g})=>{const{canDelete:v,canUpdate:d,canRead:C}=a,B=v||d||C,[{query:M}]=(0,l.useQueryParams)(),{formatMessage:Q}=(0,A.Z)(),[,j]=M?M.sort.split(":"):"ASC",{push:w,location:{pathname:Y}}=(0,N.k6)(),{trackUsage:o}=(0,l.useTracking)(),X=u.sort((i,q)=>{const J=i.name.localeCompare(q.name);return j==="DESC"?-J:J});return e.createElement(l.DynamicTable,{headers:r,contentType:c,rows:u,withBulkActions:B,isLoading:y,onConfirmDelete:p},e.createElement(s.p,null,X.map(i=>e.createElement(P.Tr,{key:i.id,...(0,l.onRowClick)({fn(){o("willEditTokenFromList",{tokenType:g}),w(`${Y}/${i.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(k.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},i.name)),e.createElement(m.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(k.Z,{textColor:"neutral800",ellipsis:!0},i.description)),e.createElement(m.Td,null,e.createElement(k.Z,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(i.createdAt)}))),e.createElement(m.Td,null,i.lastUsedAt&&e.createElement(k.Z,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(i.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:Q({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),B&&e.createElement(m.Td,null,e.createElement(U.k,{justifyContent:"end"},d&&e.createElement(S,{tokenName:i.name,tokenId:i.id}),!d&&C&&e.createElement(f,{tokenName:i.name,tokenId:i.id}),v&&e.createElement(O,{tokenName:i.name,onClickDelete:()=>p(i.id),tokenType:g})))))))};L.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},L.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const W=L},81966:(z,E,t)=>{t.d(E,{Z:()=>e,f:()=>s});const e="api-token",s="transfer-token"},71362:(z,E,t)=>{t.r(E),t.d(E,{default:()=>b});var e=t(53547),s=t(5504),P=t(7694),m=t(36364),k=t(57713),U=t(79371),l=t(26789),x=t(19442),n=t(12978),A=t(80129),N=t.n(A),V=t(86896),R=t(75336),F=t(16550),T=t(81966),O=t(92668);const $=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],H=()=>{(0,s.useFocusWhenNavigate)();const h=(0,R.useQueryClient)(),{formatMessage:f}=(0,V.Z)(),D=(0,s.useNotification)(),I=(0,P.v9)(m._),{allowedActions:{canCreate:S,canDelete:L,canUpdate:W,canRead:a}}=(0,s.useRBAC)(I.settings["api-tokens"]),{push:r}=(0,F.k6)(),{trackUsage:c}=(0,s.useTracking)(),{startSection:y}=(0,s.useGuidedTour)(),u=(0,e.useRef)(y),{get:p,del:g}=(0,s.useFetchClient)();(0,e.useEffect)(()=>{u.current&&u.current("apiTokens")},[]),(0,e.useEffect)(()=>{r({search:N().stringify({sort:"name:ASC"},{encode:!1})})},[r]);const v=$.map(o=>({...o,metadatas:{...o.metadatas,label:f(o.metadatas.label)}})),{data:d,status:C,isFetching:B}=(0,R.useQuery)(["api-tokens"],async()=>{c("willAccessTokenList",{tokenType:T.Z});const{data:{data:o}}=await p("/admin/api-tokens");return c("didAccessTokenList",{number:o.length,tokenType:T.Z}),o},{enabled:a,onError(){D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),M=a&&(C!=="success"&&C!=="error"||C==="success"&&B),Q=(0,R.useMutation)(async o=>{await g(`/admin/api-tokens/${o}`)},{async onSuccess(){await h.invalidateQueries(["api-tokens"]),c("didDeleteToken")},onError(o){o?.response?.data?.data?D({type:"warning",message:o.response.data.data}):D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),j=a&&d,w=a&&!d&&!S,Y=a&&!d&&S;return e.createElement(k.o,{"aria-busy":M},e.createElement(s.SettingsPageTitle,{name:"API Tokens"}),e.createElement(U.T,{title:f({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:f({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:S?e.createElement(s.LinkButton,{"data-testid":"create-api-token-button",startIcon:e.createElement(n.Z,null),size:"S",onClick:()=>c("willAddTokenFromList",{tokenType:T.Z}),to:"/settings/api-tokens/create"},f({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),e.createElement(l.D,null,!a&&e.createElement(s.NoPermissions,null),j&&e.createElement(O.Z,{permissions:{canRead:a,canDelete:L,canUpdate:W},headers:v,contentType:"api-tokens",rows:d,isLoading:M,onConfirmDelete:o=>Q.mutateAsync(o),tokens:d,tokenType:T.Z}),Y&&e.createElement(s.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(x.z,{variant:"secondary",startIcon:e.createElement(n.Z,null)},f({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),w&&e.createElement(s.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},b=()=>{const h=(0,P.v9)(m._);return e.createElement(s.CheckPagePermissions,{permissions:h.settings["api-tokens"].main},e.createElement(H,null))}}}]);
