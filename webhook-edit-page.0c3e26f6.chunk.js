"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[5162],{34882:(ne,b,t)=>{t.d(b,{Z:()=>le});var e=t(53547),I=t(50253),p=t(75878),T=t(4090),U=t(28809),X=t(23440),B=t(74880),l=t(43247),se=t(22996),ae=t(78549),H=t(775),N=t(13539),A=t(62779),G=t(94649),ie=t(45697),f=t.n(ie),Q=t(86896),O=t(88972),de=t(92686);const g=s=>s.reduce((o,c)=>{const v=c.split(".")[0];return o[v]||(o[v]=[]),o[v].push(c),o},{}),Z=(0,O.default)(I.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,re=s=>{const o=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(o.push({id:"app.utils.publish",defaultMessage:"Publish"}),o.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),o},J=s=>{const o=["entry.create","entry.update","entry.delete"];return s&&o.push("entry.publish","entry.unpublish"),{entry:o,media:["media.create","media.update","media.delete"]}},Y=e.createContext(),oe=({children:s})=>{const{formatMessage:o}=(0,Q.Z)(),{collectionTypes:c,isLoading:v}=(0,de.G)(),u=e.useMemo(()=>c.some(D=>D.options.draftAndPublish===!0),[c]),k=o({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(Y.Provider,{value:{isDraftAndPublish:u}},e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(T.Q,{"aria-hidden":!0},k),v&&e.createElement(U.a,null,o({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(Z,{"aria-label":k},s)))};oe.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired};const _=({getHeaders:s=re})=>{const{isDraftAndPublish:o}=e.useContext(Y),{formatMessage:c}=(0,Q.Z)(),v=s(o);return e.createElement(X.S,null,e.createElement(B.Z,null,e.createElement(l.g,null,e.createElement(se.T,null,c({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),v.map(u=>["app.utils.publish","app.utils.unpublish"].includes(u.id)?e.createElement(l.g,{key:u.id,title:c({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(ae.Z,{variant:"sigma",textColor:"neutral600"},c(u))):e.createElement(l.g,{key:u.id},e.createElement(ae.Z,{variant:"sigma",textColor:"neutral600"},c(u))))))};_.defaultProps={getHeaders:re},_.propTypes={getHeaders:f().func};const q=({providedEvents:s})=>{const{isDraftAndPublish:o}=e.useContext(Y),c=s||J(o),{values:v,handleChange:u}=(0,G.useFormikContext)(),k="events",D=v.events,w=[],x=g(D),L=({target:{name:C,value:m}})=>{let P=new Set(D);m?P.add(C):P.delete(C),u({target:{name:k,value:Array.from(P)}})},F=({target:{name:C,value:m}})=>{let P=new Set(D);m?c[C].forEach(M=>{w.includes(M)||P.add(M)}):c[C].forEach(M=>P.delete(M)),u({target:{name:k,value:Array.from(P)}})};return e.createElement(H.X,null,Object.entries(c).map(([C,m])=>e.createElement(j,{disabledEvents:w,key:C,name:C,events:m,inputValue:x[C],handleSelect:L,handleSelectAll:F})))};q.defaultProps={providedEvents:null},q.propTypes={providedEvents:f().object};const ce=s=>s.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),j=({disabledEvents:s,name:o,events:c,inputValue:v,handleSelect:u,handleSelectAll:k})=>{const{formatMessage:D}=(0,Q.Z)(),w=c.filter(m=>!s.includes(m)),x=v.length>0,L=v.length===w.length,F=({target:{name:m}})=>{k({target:{name:m,value:!L}})},C=5;return e.createElement(B.Z,null,e.createElement(l.f,null,e.createElement(N.X,{indeterminate:x&&!L,"aria-label":D({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:o,onChange:F,value:L},ce(o))),c.map(m=>e.createElement(l.f,{key:m},e.createElement(A.C,{disabled:s.includes(m),"aria-label":m,name:m,value:v.includes(m),onValueChange:P=>u({target:{name:m,value:P}})}))),c.length<C&&e.createElement(l.f,{colSpan:`${C-c.length}`}))};j.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},j.propTypes={disabledEvents:f().array,events:f().array,inputValue:f().array,handleSelect:f().func,handleSelectAll:f().func,name:f().string.isRequired};const le={Root:oe,Headers:_,Body:q,EventRow:j}},81164:(ne,b,t)=>{t.d(b,{Z:()=>fe});var e=t(53547),I=t(57713),p=t(5504),T=t(75336),U=t(16550),X=t(92686),B=t(79371),l=t(75878),se=t(19442),ae=t(26789),H=t(50781),N=t(9370),A=t(61585),G=t(28469),ie=t(85362),f=t(8675),Q=t(60793),O=t(94649),de=t(45697),g=t.n(de),Z=t(86896),re=t(80902),J=t(34882);function Y(){return e.createElement(J.Z.Root,null,e.createElement(J.Z.Headers,null),e.createElement(J.Z.Body,null))}var oe=t(4090),_=t(90139),q=t(12978),ce=t(63122),j=t(85612);const le=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],s=({name:n,onChange:a,value:r,...d})=>{const{values:{headers:E}}=(0,O.useFormikContext)(),[y,i]=(0,e.useState)(le);(0,e.useEffect)(()=>{i(le.filter(h=>!E?.some(K=>K.key!==r&&K.key===h)))},[E,r]);const $=h=>{a({target:{name:n,value:h}})},z=h=>{i(K=>[...K,h]),$(h)};return e.createElement(ce.XU,{...d,onClear:()=>$(""),onChange:$,onCreateOption:z,placeholder:"",value:r},y.map(h=>e.createElement(j.O,{value:h,key:h},h)))};s.defaultProps={value:void 0},s.propTypes={name:g().string.isRequired,onChange:g().func.isRequired,value:g().string};const o=s,v=()=>{const{formatMessage:n}=(0,Z.Z)(),{values:a,errors:r}=(0,O.useFormikContext)();return e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(oe.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(H.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(O.FieldArray,{validateOnChange:!1,name:"headers",render:({push:d,remove:E})=>e.createElement(N.r,{gap:4},a.headers.map((y,i)=>e.createElement(e.Fragment,{key:`${i}.${y.key}`},e.createElement(A.P,{col:6},e.createElement(O.Field,{as:o,name:`headers.${i}.key`,"aria-label":`row ${i+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:r.headers?.[i]?.key&&r.headers[i].key})),e.createElement(A.P,{col:6},e.createElement(l.k,{alignItems:"flex-end"},e.createElement(H.x,{style:{flex:1}},e.createElement(O.Field,{as:G.o,name:`headers.${i}.value`,"aria-label":`row ${i+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:r.headers?.[i]?.value&&r.headers[i].value})),e.createElement(l.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:r.headers?.[i]?.value?0:5},e.createElement(p.RemoveRoundedButton,{disabled:a.headers.length===1,onClick:()=>E(i),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:i+1})})))))),e.createElement(A.P,{col:12},e.createElement(_.A,{type:"button",onClick:()=>{d({key:"",value:""})},startIcon:e.createElement(q.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var u=t(78549),k=t(64518),D=t(15800),w=t(88972);const x=w.default.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),L=({isPending:n,statusCode:a})=>{const{formatMessage:r}=(0,Z.Z)();return n?e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(x,{as:k.Z}),e.createElement(u.Z,null,r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(x,{as:f.Z,color:"success700"}),e.createElement(u.Z,null,r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(x,{as:D.Z,color:"danger700"}),e.createElement(u.Z,null,r({id:"Settings.error",defaultMessage:"error"})," ",a)):null};L.propTypes={isPending:g().bool.isRequired,statusCode:g().number},L.defaultProps={statusCode:void 0};const F=({statusCode:n,message:a})=>{const{formatMessage:r}=(0,Z.Z)();return n>=200&&n<300?e.createElement(l.k,{justifyContent:"flex-end"},e.createElement(u.Z,{textColor:"neutral600",ellipsis:!0},r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(l.k,{justifyContent:"flex-end"},e.createElement(l.k,{maxWidth:(0,p.pxToRem)(250),justifyContent:"flex-end",title:a},e.createElement(u.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};F.propTypes={statusCode:g().number,message:g().string},F.defaultProps={statusCode:void 0,message:void 0};const C=({onCancel:n})=>{const{formatMessage:a}=(0,Z.Z)();return e.createElement(l.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(u.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(x,{as:D.Z,color:"neutral400"}))))};C.propTypes={onCancel:g().func.isRequired};const m=({isPending:n,onCancel:a,response:r})=>{const{statusCode:d,message:E}=r,{formatMessage:y}=(0,Z.Z)();return e.createElement(H.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(N.r,{gap:4,style:{alignItems:"center"}},e.createElement(A.P,{col:3},e.createElement(u.Z,null,y({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(A.P,{col:3},e.createElement(L,{isPending:n,statusCode:d})),e.createElement(A.P,{col:6},n?e.createElement(C,{onCancel:a}):e.createElement(F,{statusCode:d,message:E}))))};m.defaultProps={isPending:!1,onCancel(){},response:{}},m.propTypes={isPending:g().bool,onCancel:g().func,response:g().object};const P=m;var M=t(87561);const ge=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ee=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,he=({formatMessage:n})=>M.object().shape({name:M.string().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ge,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:M.string().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ee,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:M.lazy(a=>{let r=M.array();if(a.length===1){const{key:d,value:E}=a[0];if(!d&&!E)return r}return r.of(M.object().shape({key:M.string().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:M.string().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:M.array()}),ue=({handleSubmit:n,triggerWebhook:a,isCreating:r,isTriggering:d,triggerResponse:E,data:y})=>{const{formatMessage:i}=(0,Z.Z)(),[$,z]=(0,e.useState)(!1),h=(0,re.c)(Y,async()=>(await t.e(568).then(t.bind(t,70568))).EventTableEE),K=W=>Object.keys(W).length?Object.entries(W).map(([ee,te])=>({key:ee,value:te})):[{key:"",value:""}],R=(0,O.useFormik)({initialValues:{name:y?.name||"",url:y?.url||"",headers:K(y?.headers||{}),events:y?.events||[]},onSubmit(W,{resetForm:ee,setSubmitting:te}){n(W),ee({values:W}),te(!1)},validationSchema:he({formatMessage:i}),validateOnChange:!1,validateOnBlur:!1});return h?e.createElement(O.FormikProvider,{value:R},e.createElement(p.Form,{onSubmit:R.handleSubmit},e.createElement(B.T,{primaryAction:e.createElement(l.k,{gap:2},e.createElement(se.z,{onClick:()=>{a(),z(!0)},variant:"tertiary",startIcon:e.createElement(ie.Z,null),disabled:r||d,size:"L"},i({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(se.z,{startIcon:e.createElement(f.Z,null),type:"submit",size:"L",disabled:!R.dirty,loading:R.isSubmitting},i({id:"global.save",defaultMessage:"Save"}))),title:r?i({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):y?.name,navigationAction:e.createElement(p.Link,{startIcon:e.createElement(Q.Z,null),to:"/settings/webhooks"},i({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ae.D,null,e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},$&&e.createElement(P,{isPending:d,response:E,onCancel:()=>z(!1)}),e.createElement(H.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(N.r,{gap:6},e.createElement(A.P,{col:6},e.createElement(O.Field,{as:G.o,name:"name",error:R?.errors?.name&&R.errors.name,label:i({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(A.P,{col:12},e.createElement(O.Field,{as:G.o,name:"url",error:R?.errors?.url&&R.errors.url,label:i({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(v,null),e.createElement(h,null))))))):null};ue.propTypes={data:g().object,handleSubmit:g().func.isRequired,triggerWebhook:g().func.isRequired,isCreating:g().bool.isRequired,isTriggering:g().bool.isRequired,triggerResponse:g().object},ue.defaultProps={data:void 0,triggerResponse:void 0};const pe=ue,me=n=>({...n,headers:n.headers.reduce((a,{key:r,value:d})=>(r!==""&&(a[r]=d),a),{})}),fe=()=>{const{params:{id:n}}=(0,U.$B)("/settings/webhooks/:id"),a=n==="create",{replace:r}=(0,U.k6)(),d=(0,p.useNotification)(),{formatAPIError:E}=(0,p.useAPIErrorHandler)(),y=(0,T.useQueryClient)(),{isLoading:i}=(0,X.G)(),{put:$,get:z,post:h}=(0,p.useFetchClient)(),{isLoading:K,data:R,error:W}=(0,T.useQuery)(["webhooks",n],async()=>{const{data:{data:S}}=await z(`/admin/webhooks/${n}`);return S},{enabled:!a});e.useEffect(()=>{W&&d({type:"warning",message:E(W)})},[W,d,E]);const{isLoading:ee,data:te,isIdle:ve,mutate:Ce}=(0,T.useMutation)(()=>h(`/admin/webhooks/${n}/trigger`)),Me=()=>Ce(null,{onError(S){d({type:"warning",message:E(S)})}}),ye=(0,T.useMutation)(S=>h("/admin/webhooks",S)),Pe=(0,T.useMutation)(({id:S,body:V})=>$(`/admin/webhooks/${S}`,V)),be=async S=>{if(a){ye.mutate(me(S),{onSuccess({data:V}){d({type:"success",message:{id:"Settings.webhooks.created"}}),r(`/settings/webhooks/${V.data.id}`)},onError(V){d({type:"warning",message:E(V)})}});return}Pe.mutate({id:n,body:me(S)},{onSuccess(){y.invalidateQueries(["webhooks",n]),d({type:"success",message:{id:"notification.form.success.fields"}})},onError(V){d({type:"warning",message:E(V)})}})};return K||i?e.createElement(p.LoadingIndicatorPage,null):e.createElement(I.o,null,e.createElement(p.SettingsPageTitle,{name:"Webhooks"}),e.createElement(pe,{data:R,handleSubmit:be,triggerWebhook:Me,isCreating:a,isTriggering:ee,isTriggerIdle:ve,triggerResponse:te?.data.data}))}},71589:(ne,b,t)=>{t.r(b),t.d(b,{default:()=>B});var e=t(53547),I=t(5504),p=t(7694),T=t(36364),U=t(81164);const B=()=>{const l=(0,p.v9)(T._);return e.createElement(I.CheckPagePermissions,{permissions:l.settings.webhooks.create},e.createElement(U.Z,null))}},10372:(ne,b,t)=>{t.r(b),t.d(b,{default:()=>B});var e=t(53547),I=t(5504),p=t(7694),T=t(36364),U=t(81164);const B=()=>{const l=(0,p.v9)(T._);return e.createElement(I.CheckPagePermissions,{permissions:l.settings.webhooks.update},e.createElement(U.Z,null))}},85612:(ne,b,t)=>{t.d(b,{O:()=>I});var e=t(63122);const I=e.Wx}}]);
