"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[4263],{54920:(W,u,e)=>{e.d(u,{R:()=>d});var t=e(5504),a=e(75336);function d(m={},f={}){const{id:n="",...s}=m,{get:g}=(0,t.useFetchClient)(),{data:r,isError:o,isLoading:l,refetch:M}=(0,a.useQuery)(["users",n,s],async()=>{const{data:{data:y}}=await g(`/admin/users/${n}`,{params:s});return y},f);let v=[];return n&&r?v=[r]:Array.isArray(r?.results)&&(v=r.results),{users:v,pagination:r?.pagination??null,isLoading:l,isError:o,refetch:M}}},93552:(W,u,e)=>{e.r(u),e.d(u,{default:()=>oe});var t=e(53547),a=e(5504),d=e(7694),m=e(16550),f=e(36364),n=e(57713),s=e(79371),g=e(19442),r=e(26789),o=e(50781),l=e(75878),M=e(78549),v=e(9370),y=e(61585),L=e(8675),B=e(60793),R=e(94649),C=e(27361),Z=e.n(C),N=e(57557),$=e.n(N),j=e(78718),A=e.n(j),Y=e(45697),G=e.n(Y),H=e(86896),Q=e(54920),V=e(80902),E=e(25804),ee=e(30164),te=e(85078),ae=e(39394);const se=async(D,c)=>{const{put:T}=(0,a.getFetchClient)(),{data:U}=await T(`/admin/users/${D}`,c);return U.data},ne=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],J=["email","firstname","lastname","username","isActive","roles"],k=({canUpdate:D})=>{const{formatMessage:c}=(0,H.Z)(),{params:{id:T}}=(0,m.$B)("/settings/users/:id"),{push:U}=(0,m.k6)(),{setUserDisplayName:K}=(0,a.useAppInfo)(),h=(0,a.useNotification)(),{lockApp:X,unlockApp:b}=(0,a.useOverlayBlocker)(),w=(0,V.c)(ee.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE);(0,a.useFocusWhenNavigate)();const{users:[S],isLoading:le}=(0,Q.R)({id:T},{onError(i){const{status:p}=i.response;p===403?(h({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),U("/")):h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),ie=async(i,p)=>{X();try{const P=await se(T,$()(i,"confirmPassword"));h({type:"success",message:c({id:"notification.success.saved",defaultMessage:"Saved"})});const I=a.auth.getUserInfo();if(T.toString()===I.id.toString()){a.auth.setUserInfo(P);const z=Z()(i,"username")||(0,E.Pp)(i.firstname,i.lastname);K(z)}p.setValues(A()(i,J))}catch(P){const I=(0,E.Iz)(P.response.data),z=Object.keys(I).reduce((F,O)=>(F[O]=I[O].id,F),{});p.setErrors(z),h({type:"warning",message:Z()(P,"response.data.error.message","notification.error")})}b()},q=le||!w,de=q?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},x=Object.keys(A()(S,J)).reduce((i,p)=>p==="roles"?(i[p]=(S?.roles||[]).map(({id:P})=>P),i):(i[p]=S?.[p],i),{}),ce=x.username||(0,E.Pp)(x.firstname,x.lastname),_=c(de,{name:ce});return q?t.createElement(n.o,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(s.T,{primaryAction:t.createElement(g.z,{disabled:!0,startIcon:t.createElement(L.Z,null),type:"button",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:_,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(B.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},c({id:"global.back",defaultMessage:"Back"}))}),t.createElement(r.D,null,t.createElement(a.LoadingIndicatorPage,null))):t.createElement(n.o,null,t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(R.Formik,{onSubmit:ie,initialValues:x,validateOnChange:!1,validationSchema:ae.YM},({errors:i,values:p,handleChange:P,isSubmitting:I,dirty:z})=>t.createElement(a.Form,null,t.createElement(s.T,{primaryAction:t.createElement(g.z,{disabled:I||!D?!0:!z,startIcon:t.createElement(L.Z,null),loading:I,type:"submit",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:_,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(B.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},c({id:"global.back",defaultMessage:"Back"}))}),t.createElement(r.D,null,S?.registrationToken&&t.createElement(o.x,{paddingBottom:6},t.createElement(w,{registrationToken:S.registrationToken})),t.createElement(l.k,{direction:"column",alignItems:"stretch",gap:7},t.createElement(o.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(M.Z,{variant:"delta",as:"h2"},c({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(v.r,{gap:5},ne.map(F=>F.map(O=>t.createElement(y.P,{key:O.name,...O.size},t.createElement(a.GenericInput,{...O,disabled:!D,error:i[O.name],onChange:P,value:p[O.name]||""}))))))),t.createElement(o.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(M.Z,{variant:"delta",as:"h2"},c({id:"global.roles",defaultMessage:"User's role"})),t.createElement(v.r,{gap:5},t.createElement(y.P,{col:6,xs:12},t.createElement(te.Z,{disabled:!D,error:i.roles,onChange:P,value:p.roles}))))))))))};k.propTypes={canUpdate:G().bool.isRequired};const re=k,oe=()=>{const D=(0,a.useNotification)(),c=(0,d.v9)(f._),T=t.useMemo(()=>({read:c.settings.users.read,update:c.settings.users.update}),[c.settings.users]),{isLoading:U,allowedActions:{canRead:K,canUpdate:h}}=(0,a.useRBAC)(T),{state:X}=(0,m.TH)(),b=X?.from??"/";return(0,t.useEffect)(()=>{U||!K&&!h&&D({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[U,K,h,D]),U?t.createElement(a.LoadingIndicatorPage,null):!K&&!h?t.createElement(m.l_,{to:b}):t.createElement(re,{canUpdate:h})}},6324:(W,u,e)=>{e.d(u,{Z:()=>r});var t=e(53547),a=e(37527),d=e(5504),m=e(70780),f=e(45697),n=e.n(f),s=e(86896);const g=({children:o,target:l})=>{const M=(0,d.useNotification)(),{formatMessage:v}=(0,s.Z)(),{copy:y}=(0,d.useClipboard)(),L=v({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),B=async()=>{await y(l)&&M({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(d.ContentBox,{endAction:t.createElement(a.h,{label:L,noBorder:!0,icon:t.createElement(m.Z,null),onClick:B}),title:l,titleEllipsis:!0,subtitle:o,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};g.propTypes={children:n().oneOfType([n().element,n().string]).isRequired,target:n().string.isRequired};const r=g},30164:(W,u,e)=>{e.d(u,{A:()=>s});var t=e(53547),a=e(45697),d=e.n(a),m=e(86896),f=e(95651),n=e(6324);const s=({registrationToken:g})=>{const{formatMessage:r}=(0,m.Z)(),o=`${window.location.origin}${f.Z}auth/register?registrationToken=${g}`;return t.createElement(n.Z,{target:o},r({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:d().string}},85078:(W,u,e)=>{e.d(u,{Z:()=>B});var t=e(53547),a=e(50614),d=e(473),m=e(5504),f=e(64518),n=e(45697),s=e.n(n),g=e(86896),r=e(75336),o=e(88972);const l=(0,o.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,M=o.default.div`
  animation: ${l} 2s infinite linear;
`,v=()=>t.createElement(M,null,t.createElement(f.Z,null)),y=async()=>{const{get:R}=(0,m.getFetchClient)(),{data:C}=await R("/admin/roles");return C.data},L=({disabled:R,error:C,onChange:Z,value:N})=>{const{status:$,data:j}=(0,r.useQuery)(["roles"],y,{staleTime:5e4}),{formatMessage:A}=(0,g.Z)(),Y=C?A({id:C,defaultMessage:C}):"",G=A({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),H=A({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),Q=A({id:"app.components.Select.placeholder",defaultMessage:"Select"}),V=$==="loading"?t.createElement(v,null):void 0;return t.createElement(a.P,{id:"roles",disabled:R,error:Y,hint:H,label:G,name:"roles",onChange:E=>{Z({target:{name:"roles",value:E}})},placeholder:Q,multi:!0,startIcon:V,value:N.map(E=>E.toString()),withTags:!0,required:!0},(j||[]).map(E=>t.createElement(d.W,{key:E.id,value:E.id.toString()},A({id:`global.${E.code}`,defaultMessage:E.name}))))};L.defaultProps={disabled:!1,error:void 0},L.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const B=L},39394:(W,u,e)=>{e.d(u,{YM:()=>r,Rw:()=>f});var t=e(87561),a=e(5504);const d={firstname:t.string().trim().required(a.translatedErrors.required),lastname:t.string(),email:t.string().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:t.string().nullable(),password:t.string().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.string().min(8,a.translatedErrors.minLength).oneOf([t.ref("password"),null],"components.Input.error.password.noMatch").when("password",(o,l)=>o?l.required(a.translatedErrors.required):l)},f={...d,currentPassword:t.string().when(["password","confirmPassword"],(o,l,M)=>o||l?M.required(a.translatedErrors.required):M),preferedLanguage:t.string().nullable()},s={roles:t.array().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},r=t.object().shape({...d,isActive:t.bool(),...s})}}]);
